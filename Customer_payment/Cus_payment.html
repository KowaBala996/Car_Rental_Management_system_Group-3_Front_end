<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Details - Car Rental Services</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="../Customer_Styles/cus_Styles.css">
</head>

<body>
    <header class="header">
        <div class="nav">
            <div class="logo">
                <img src="../asset/downloadlogo.png" alt="logo">
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="../Landing_Page/index.html">Home</a></li>
                    <li><a href="../AboutUs/about.html">About Us</a></li>
                    <li><a href="../Car_Categories/get-car.html">Get Car</a></li>
                    <li><a href="../Contact_us/contact.html">Contact Us</a></li>
                </ul>
            </nav>
            <div class="user-dropdown">
                User â–¼
                <div class="user-dropdown-content">
                    <a href="">Profile</a>
                    <a href="../Customer_login/login.html">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="payment-form">
            <div class="container">
                <div class="reminder">
                    <strong>Payment Reminder:</strong><br>
                    Booking payment is <strong>Rs.1000</strong>.<br>
                    The request is accepted only after paying the booking payment.<br>
                    <span style="color: red;font-weight: bold;">Booking payment is non-refundable.</span>
                </div>
                <form id="payment-form">

                    <div class="container">
                        <h2>Car Rental Details</h2>
                        <div id="car-details-container">
                            <!-- Car details will be displayed here -->
                        </div>
                    </div>
                    <fieldset>
                        <legend>Payment Information</legend>

                        <label for="payment-id">Recipt Number</label>
                        <input type="number" id="payment-id" name="payment-id" required>

                        <label for="payment-date"> Payment Date</label>
                        <input type="date" id="payment-date" name="payment-date" required>

                        <label for="payment-amount"> Booking Payment </label>
                        <input type="number" id="payment-amount" name="payment-amount" step="1000" placeholder="Advance payment is Rs.1000 only" required>

                        <label for="payment-method">Payment Method</label>
                        <input type="text" id="payment-method" name="payment-method"
                             required>

                        <label for="payment-status">Payment status Message (max 20 words):</label>
                        <input type="text" id="payment-status" name="payment-status" required>
                        <p id="word-count">0/20 words</p>
                        <button type="submit">Request</button>

                    </fieldset>

                    <div class="bank-details">
                        <h3>Bank Details</h3>
                        <p><strong>Bank:</strong> Commercial Bank</p>
                        <p><strong>Account Number:</strong> 8107043582</p>
                        <p><strong>Branch:</strong> Chunnakam</p>
                        <p><strong>Account Holder:</strong> B. Kowarthanan</p>
                    </div>


                </form>
            </div>

        </section>


    </main>

    <footer>
        <div class="container">
            <div class="footer-left">
                <h3>Car Rental Services</h3>
                <ul>
                    <li><a href="../Landing_Page/index.html">Home</a></li>
                    <li><a href="../AboutUs/about.html">About Us</a></li>
                    <li><a href="../Car_Categories/get-car.html">Get Car</a></li>
                    <li><a href="../Contact_us/contact.html">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-right">
                <h3>Contact Info</h3>
                <ul>
                    <li>Address: 40/2 Madattady road, Maviddapuram tellippalai, Jaffna</li>
                    <li>Email: <a href="mailto:info@carrental.com">info@carrental.com</a></li>
                    <li>Phone: (+94) 456-7890</li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    // Function to get query parameter from the URL
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    const carid = getQueryParam('carid'); // Extract car ID from URL
    const customerid = getQueryParam('customerid'); // Extract customer ID from URL

    // Function to display car details based on the car ID
    function displayCarDetailsById(carId) {
        const carDetailsJSON = localStorage.getItem('bookingCar'); // Fetch from local storage
        const carDetails = JSON.parse(carDetailsJSON) || [];

        // Find the car detail that matches the carId
        const carDetail = carDetails.find(car => car.carId === carid);

        if (carDetail) {
            const carDetailsHTML = `
                <p><strong>Price per Hour:</strong> Rs.${carDetail.hourlyRate}</p>
                <p><strong>Total Hours:</strong> ${carDetail.totalHours}</p>
                <p><strong>Total Price:</strong> Rs.${carDetail.totalPrice}</p>
            `;

            document.getElementById('car-details-container').innerHTML = carDetailsHTML;

            // Save the selected car details for payment processing
            localStorage.setItem('bookingCarPayment', JSON.stringify(carDetail));
        } else {
            document.getElementById('car-details-container').innerHTML = '<p>No car details available for this ID.</p>';
        }
    }

    displayCarDetailsById(carid); // Display car details for the selected car

    // Handle form submission for payment
    document.getElementById('payment-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent default form submission

        // Retrieve form data
        const paymentId = document.getElementById('payment-id').value;
        const paymentDate = document.getElementById('payment-date').value;
        const paymentAmount = document.getElementById('payment-amount').value;
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentStatus = document.getElementById('payment-status').value;

        // Retrieve last car details from local storage
        const lastCarDetail = JSON.parse(localStorage.getItem('bookingCarPayment')) || {};

        // Create a payment object with car and customer details
        const payment = {
            paymentId: paymentId,
            paymentDate: paymentDate,
            paymentAmount: parseFloat(paymentAmount),
            paymentMethod: paymentMethod,
            paymentStatus: paymentStatus,
            rentalCarId: lastCarDetail.carId || '',
            startDate: lastCarDetail.bookingStartDate || '',
            endDate: lastCarDetail.bookingEndDate || '',
            carModel: lastCarDetail.model || '',
            customerId: customerid,
            totalPrice: lastCarDetail.totalPrice || 0
        };

        // Retrieve existing payments from local storage
        let payments = JSON.parse(localStorage.getItem('bookingRequest')) || [];

        // Check if there is an existing payment for the same car and customer
        let isPayment = payments.find(p => p.rentalCarId === lastCarDetail.carId && p.customerId === customerid);

        if (isPayment) {
            alert("You have already requested the same car.");
        } else {
            // Add the new payment to the array
            payments.push(payment);

            // Save the updated array back to local storage
            localStorage.setItem('bookingRequest', JSON.stringify(payments));

            // Show a confirmation message
            alert('Request sent successfully!');
        }
    });
});

    </script>


</body>

</html>